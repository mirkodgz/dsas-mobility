import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.WFquGv8Z.js";import{s as c}from"./supabase.D34_deiT.js";import{B as h}from"./Button.CD0yd_KG.js";function B({tableName:a,title:u,fields:n,orderBy:b="name"}){const[g,v]=s.useState([]),[w,p]=s.useState(!0),[k,y]=s.useState(!1),[i,j]=s.useState(null),[l,d]=s.useState({}),x=async()=>{p(!0);const{data:r,error:t}=await c.from(a).select("*").order(b,{ascending:!0});t?(console.error("Error fetching data:",t),alert(`Errore nel caricamento dei dati: ${t.message} (${t.code||"N/A"})`)):v(r||[]),p(!1)};s.useEffect(()=>{x()},[a]);const f=(r=null)=>{if(j(r),r)d(r);else{const t={};n.forEach(o=>t[o.key]=""),d(t)}y(!0)},m=()=>{y(!1),j(null),d({})},N=r=>{d({...l,[r.target.name]:r.target.value})},E=async r=>{r.preventDefault();let t;if(i){const{error:o}=await c.from(a).update(l).eq("id",i.id);t=o}else{const{error:o}=await c.from(a).insert([l]);t=o}t?(console.error("Error saving:",t),alert("Errore nel salvataggio: "+t.message)):(m(),x())},C=async r=>{if(!confirm("Sei sicuro di voler eliminare questo elemento?"))return;const{error:t}=await c.from(a).delete().eq("id",r);t?(console.error("Error deleting:",t),alert("Errore: impossibile eliminare (probabilmente Ã¨ usato in altri record)")):x()};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 md:p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:u}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["Gestisci le opzioni per ",u]})]}),e.jsx(h,{variant:"primary",onClick:()=>f(),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Aggiungi"]})})]}),w?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-100 text-gray-500 text-sm uppercase tracking-wider",children:[n.map(r=>e.jsx("th",{className:"pb-4 font-semibold",children:r.label},r.key)),e.jsx("th",{className:"pb-4 font-semibold text-right",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-50",children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:n.length+1,className:"py-8 text-center text-gray-400",children:"Nessun dato presente"})}):g.map(r=>e.jsxs("tr",{className:"group hover:bg-gray-50 transition-colors",children:[n.map(t=>e.jsx("td",{className:"py-4 font-medium text-gray-700",children:r[t.key]},t.key)),e.jsx("td",{className:"py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>f(r),className:"p-2 text-gray-400 hover:text-primary hover:bg-blue-50 rounded-lg transition-colors",title:"Modifica",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),e.jsx("button",{onClick:()=>C(r.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Elimina",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})})]},r.id))})]})}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl overflow-hidden animate-zoom-in",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[e.jsxs("h3",{className:"font-bold text-lg text-gray-800",children:[i?"Modifica":"Aggiungi"," elemento"]}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("form",{onSubmit:E,className:"p-6 space-y-4",children:[n.map(r=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:r.label}),e.jsx("input",{type:r.type||"text",name:r.key,value:l[r.key]||"",onChange:N,className:"w-full h-10 px-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all",required:!0})]},r.key)),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx(h,{variant:"outline",type:"button",onClick:m,className:"border-gray-300 text-gray-600",children:"Annulla"}),e.jsx(h,{variant:"primary",type:"submit",children:i?"Salva Modifiche":"Crea Elemento"})]})]})]})})]})}export{B as default};
